<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambola Admin - Join</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Default font */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-base-200 min-h-screen flex flex-col" x-data="adminJoin()">
    <nav class="navbar bg-base-100 shadow-lg sticky top-0 z-50">
        <div class="flex-1">
            <a class="btn btn-ghost normal-case text-xl">Tambola Admin Panel</a>
        </div>
        <div class="flex-none">
            <div class="dropdown dropdown-end">
                <label tabindex="0" class="btn btn-ghost btn-circle" aria-label="Theme selector">
                    <i class="fas fa-palette"></i>
                </label>
                <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                    <template x-for="theme in themes" :key="theme">
                        <li><a @click="setTheme(theme, $event)" x-text="theme.charAt(0).toUpperCase() + theme.slice(1)"></a></li>
                    </template>
                </ul>
            </div>
        </div>
    </nav>

    <main class="flex-grow flex items-center justify-center p-4">
        <div class="card w-full max-w-md bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-6 text-center">Admin Login</h2>
                
                <div class="form-control mb-4">
                    <label class="label">
                        <span class="label-text">Admin Name</span>
                    </label>
                    <input type="text" x-model="adminName" placeholder="Enter your name" class="input input-bordered w-full" />
                    <p x-show="errors.adminName" x-text="errors.adminName" class="text-error text-xs mt-1"></p>
                </div>

                <div class="form-control mb-6">
                    <label class="label">
                        <span class="label-text">Create or Enter Room ID</span>
                    </label>
                    <input type="text" x-model="roomId" placeholder="Enter a unique Room ID" class="input input-bordered w-full" />
                     <p x-show="errors.roomId" x-text="errors.roomId" class="text-error text-xs mt-1"></p>
                </div>

                <div class="card-actions justify-center">
                    <button @click="joinRoom" class="btn btn-primary w-full">
                        Join / Create Room
                    </button>
                </div>
                 <div x-show="message" class="mt-4 p-2 rounded-md text-center"
                     :class="{ 'bg-success text-success-content': messageType === 'success', 'bg-error text-error-content': messageType === 'error' }"
                     x-text="message">
                </div>
            </div>
        </div>
    </main>

    <footer class="footer footer-center p-4 bg-base-300 text-base-content">
        <div>
            <p>Copyright Â© <span x-text="new Date().getFullYear()"></span> - Tambola Game</p>
        </div>
    </footer>

    <script>
        function adminJoin() {
            return {
                adminName: '',
                roomId: '',
                message: '',
                messageType: '', // 'success' or 'error'
                errors: {
                    adminName: '',
                    roomId: ''
                },
                themes: [ // Common DaisyUI themes
                    "light", "dark", "cupcake", "bumblebee", "emerald", "corporate", 
                    "synthwave", "retro", "cyberpunk", "valentine", "halloween", 
                    "garden", "forest", "aqua", "lofi", "pastel", "fantasy", 
                    "wireframe", "black", "luxury", "dracula", "cmyk", "autumn", 
                    "business", "acid", "lemonade", "night", "coffee", "winter"
                ],
                init() {
                    // Load saved theme or default to light
                    const savedTheme = localStorage.getItem('theme') || 'light';
                    // Pass null for event and false for closeDropdown on initial load
                    this.setTheme(savedTheme, null, false); 

                    // Try to get adminName and roomId from query params if redirected from admin_room
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.has('adminName')) {
                        this.adminName = urlParams.get('adminName');
                    }
                    if (urlParams.has('roomId')) {
                        this.roomId = urlParams.get('roomId');
                    }
                },
                // Updated setTheme function to reliably close the dropdown
                setTheme(themeName, event = null, closeDropdown = true) {
                    document.documentElement.setAttribute('data-theme', themeName);
                    localStorage.setItem('theme', themeName);
                    
                    if (closeDropdown && event && event.target) {
                        const anchorElement = event.target; // The <a> tag that was clicked
                        const dropdownContent = anchorElement.closest('.dropdown-content'); // The <ul>
                        const dropdownRoot = anchorElement.closest('.dropdown'); // The main <div class="dropdown">
                        const dropdownTriggerLabel = dropdownRoot?.querySelector('label[tabindex="0"]'); // The <label>

                        // Use setTimeout to ensure these actions run after the current event cycle
                        setTimeout(() => {
                            // 1. If the clicked anchor or another element inside the dropdown has focus, blur it.
                            if (document.activeElement && dropdownRoot && dropdownRoot.contains(document.activeElement)) {
                                if (typeof document.activeElement.blur === 'function') {
                                    document.activeElement.blur();
                                }
                            }
                            // 2. Then, ensure the dropdown content (<ul>) itself is blurred, as it's focusable.
                            if (dropdownContent && typeof dropdownContent.blur === 'function') {
                                dropdownContent.blur();
                            }
                            // 3. Finally, ensure the main trigger label is blurred. This is key for DaisyUI focus-based dropdowns.
                            if (dropdownTriggerLabel && typeof dropdownTriggerLabel.blur === 'function') {
                                dropdownTriggerLabel.blur();
                            }
                        }, 0); // A 0ms delay pushes this to the end of the event queue.
                    }
                },
                validateInput() {
                    this.errors.adminName = '';
                    this.errors.roomId = '';
                    let isValid = true;
                    if (!this.adminName.trim()) {
                        this.errors.adminName = 'Admin name is required.';
                        isValid = false;
                    }
                    if (!this.roomId.trim()) {
                        this.errors.roomId = 'Room ID is required.';
                        isValid = false;
                    }
                    return isValid;
                },
                joinRoom() {
                    this.message = ''; // Clear previous messages
                    if (!this.validateInput()) {
                        return;
                    }

                    // Placeholder for backend connection
                    // console.log(`Attempting to join room with Admin: ${this.adminName}, Room ID: ${this.roomId}`);
                    // fetch('https://tambola-backend.onrender.com/admin/create-room', { // Example endpoint
                    //     method: 'POST',
                    //     headers: { 'Content-Type': 'application/json' },
                    //     body: JSON.stringify({ adminName: this.adminName, roomId: this.roomId })
                    // })
                    // .then(response => {
                    //     if (!response.ok) {
                    //         return response.json().then(err => { throw err; });
                    //     }
                    //     return response.json();
                    // })
                    // .then(data => {
                    //     if (data.success) { 
                    //         this.messageType = 'success';
                    //         this.message = data.message || `Successfully joined/created room ${this.roomId}. Redirecting...`;
                    //         localStorage.setItem('adminName', this.adminName);
                    //         localStorage.setItem('roomId', this.roomId);
                    //         setTimeout(() => {
                    //             window.location.href = `admin_room.html?adminName=${encodeURIComponent(this.adminName)}&roomId=${encodeURIComponent(this.roomId)}`;
                    //         }, 1500);
                    //     } else {
                    //         this.messageType = 'error';
                    //         this.message = data.message || 'Failed to join or create room.';
                    //     }
                    // })
                    // .catch(error => {
                    //     console.error('Error joining room:', error);
                    //     this.messageType = 'error';
                    //     this.message = error.message || 'An error occurred. Please try again.';
                    // });

                    // For now, we'll simulate a successful join and redirect.
                    console.log(`Admin: ${this.adminName}, Room ID: ${this.roomId}`);
                    
                    this.messageType = 'success';
                    this.message = `Joining room ${this.roomId}...`;

                    // Store adminName and roomId for the next page
                    localStorage.setItem('adminName', this.adminName);
                    localStorage.setItem('roomId', this.roomId);

                    // Redirect to admin_room.html
                    setTimeout(() => {
                        window.location.href = `admin_room.html?adminName=${encodeURIComponent(this.adminName)}&roomId=${encodeURIComponent(this.roomId)}`;
                    }, 1000); 
                }
            }
        }
    </script>
</body>
</html>
