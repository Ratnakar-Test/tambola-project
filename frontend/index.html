<!DOCTYPE html>
<html lang="en" x-data="playerDashboard()" x-init="init()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tambola Player</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.18/dist/full.css" rel="stylesheet" />
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body class="bg-base-200 min-h-screen">

<!-- üîµ Join Section -->
<div class="max-w-md mx-auto p-6" x-show="!joined">
  <h1 class="text-3xl font-bold text-center mb-4">üéüÔ∏è Join Tambola</h1>

  <div class="form-control mb-3">
    <label class="label">Room ID</label>
    <input type="text" class="input input-bordered" x-model="roomId" placeholder="Enter Room ID" />
  </div>
  <div class="form-control mb-3">
    <label class="label">Your Name</label>
    <input type="text" class="input input-bordered" x-model="playerName" placeholder="Enter your name" />
  </div>
  <button class="btn btn-primary w-full" @click="join()">Join Game</button>

  <p class="text-red-500 text-sm mt-3" x-text="roomErrorMessage"></p>
</div>

<!-- üü¢ Game UI -->
<div x-show="joined" class="p-4">

  <!-- üçî Hamburger Menu -->
  <div class="drawer drawer-end z-40">
    <input id="player-drawer" type="checkbox" class="drawer-toggle">
    <div class="drawer-content flex justify-between items-center mb-3">
      <h2 class="text-2xl font-semibold">Welcome, <span x-text="playerName"></span></h2>
      <label for="player-drawer" class="btn btn-ghost drawer-button">‚ò∞</label>
    </div>
    <div class="drawer-side">
      <label for="player-drawer" class="drawer-overlay"></label>
      <aside class="menu p-4 w-64 bg-base-100 text-base-content">
        <h3 class="text-lg font-bold mb-4">Menu</h3>
        <ul class="space-y-2">
          <li><a>How to Play</a></li>
          <li><a>Rules</a></li>
        </ul>
      </aside>
    </div>
  </div>

  <!-- üî¢ Called Numbers -->
  <div class="mb-4">
    <h3 class="font-semibold mb-2">Called Numbers:</h3>
    <div class="flex flex-wrap gap-2">
      <template x-for="n in called" :key="n">
        <span class="badge badge-neutral" :class="n === latest ? 'badge-primary' : ''" x-text="n"></span>
      </template>
    </div>
  </div>

  <!-- üéüÔ∏è Ticket Grid -->
  <div class="grid gap-6">
    <template x-for="ticket in tickets" :key="ticket.id">
      <div class="bg-white shadow rounded p-4">
        <h4 class="font-semibold mb-2">Ticket #<span x-text="ticket.id"></span></h4>
        <div class="grid grid-cols-9 gap-1">
          <template x-for="(cell, idx) in ticket.layout.flat()" :key="idx">
            <div class="border p-2 text-center"
                 :class="cell && isMarked(ticket, cell) ? 'bg-primary text-white font-bold' : 'bg-base-100'" x-text="cell || ''"
                 @click="cell && toggleMark(ticket.id, cell)">
            </div>
          </template>
        </div>
      </div>
    </template>
  </div>

  <!-- ‚öôÔ∏è Bottom Bar -->
  <div class="btm-nav z-50">
    <button @click="requestTicket()" class="active">
      ‚ûï Add Ticket
    </button>
    <button @click="showClaimModal = true">
      üéØ Claim
    </button>
    <label>
      <input type="checkbox" class="toggle toggle-sm toggle-primary" x-model="autoMark" @change="autoChanged()" />
      <span class="ml-2">Auto</span>
    </label>
  </div>
</div>

<!-- ‚úÖ Add Ticket Modal -->
<div class="modal modal-open" x-show="showAddModal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">Ticket Request Sent</h3>
    <p>Waiting admin approval...</p>
  </div>
</div>

<!-- ‚úÖ Claim Modal -->
<div class="modal" x-show="showClaimModal">
  <div class="modal-box">
    <h3 class="font-bold text-lg mb-3">Claim a Prize</h3>
    <div class="space-y-2">
      <template x-for="prize in prizeTypes" :key="prize">
        <button class="btn btn-block" :class="selectedPrize === prize ? 'btn-primary' : 'btn-outline'" @click="selectedPrize = prize" x-text="prize"></button>
      </template>
    </div>
    <div class="mt-4 flex justify-end">
      <button class="btn btn-success" @click="claimPrize()">Submit</button>
    </div>
  </div>
</div>

<!-- ‚úÖ AutoMark Modal -->
<div class="modal modal-open" x-show="showAutoInfo">
  <div class="modal-box">
    <h3 class="font-bold text-lg" x-text="autoMark ? 'Auto Mark Enabled' : 'Manual Marking Mode'"></h3>
    <p class="text-sm mt-2">
      <span x-text="autoMark ? 'Numbers will be auto-marked.' : 'You must click to mark called numbers.'"></span>
    </p>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
